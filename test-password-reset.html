<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Password Reset - Anchored</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="app-container">
        <header class="nav-header">
            <div class="nav-content">
                <div class="logo">
                    <h1>Anchored - Password Reset Test</h1>
                </div>
            </div>
        </header>

        <main class="hero-section">
            <div class="hero-content">
                <h2>Password Reset Flow Test</h2>
                <p>This page tests the password reset functionality</p>

                <div class="auth-container">
                    <div class="auth-form">
                        <h3>Test Password Reset</h3>
                        <form id="testResetForm">
                            <div class="input-group">
                                <input type="email" id="testEmail" placeholder="Enter test email" required>
                            </div>
                            <button type="submit" class="btn-primary">Send Test Reset Email</button>
                        </form>
                        
                        <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                            <h4>Test Reset Token</h4>
                            <p style="font-size: 0.875rem; color: var(--text-secondary);">
                                To test the reset callback, add these parameters to the URL:
                            </p>
                            <code style="display: block; background: var(--bg-tertiary); padding: 0.5rem; border-radius: 6px; font-size: 0.8125rem; margin: 0.5rem 0;">
                                ?type=recovery&access_token=test_token&refresh_token=test_refresh
                            </code>
                            <button type="button" id="testCallbackBtn" class="btn-secondary">Test Reset Callback</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="js/lib/encryption.js"></script>
    <script src="js/lib/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize auth
            const auth = new Auth();
            
            // Test reset form
            document.getElementById('testResetForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('testEmail').value;
                
                try {
                    await auth.handleForgotPassword(e);
                } catch (error) {
                    console.error('Test reset error:', error);
                }
            });
            
            // Test callback button
            document.getElementById('testCallbackBtn').addEventListener('click', () => {
                const testUrl = window.location.origin + window.location.pathname + '?type=recovery&access_token=test_token&refresh_token=test_refresh';
                window.location.href = testUrl;
            });
            
            // Check for test callback
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('type') === 'recovery' && urlParams.get('access_token') === 'test_token') {
                // Simulate the callback handling
                auth.showNotification('Test callback detected! This would normally verify the token and show the password reset form.', 'info');
                
                // Show test password reset form after delay
                setTimeout(() => {
                    auth.showPasswordResetForm('test_token', 'test_refresh');
                }, 2000);
            }
        });
    </script>
</body>
</html>